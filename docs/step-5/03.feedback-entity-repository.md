# ì‚¬ìš©ì í”¼ë“œë°± ìˆ˜ì§‘

## ê°œìš”

ì‚¬ìš©ìë¡œë¶€í„° ê²€ìƒ‰ ê²°ê³¼ì— ëŒ€í•œ í”¼ë“œë°±ì„ ìˆ˜ì§‘í•˜ê³ , ì´ë¥¼ í†µí•´ AI ê²€ìƒ‰ í’ˆì§ˆì„ ê°œì„ í•©ë‹ˆë‹¤. ìˆ˜ì§‘ëœ í”¼ë“œë°± ë°ì´í„°ëŠ” **ì§€ì†ì ì¸ AI ì‹œìŠ¤í…œ ê°œì„ ì˜ í•µì‹¬ ìì‚°**ìœ¼ë¡œ í™œìš©ë©ë‹ˆë‹¤.

## í•™ìŠµ ëª©í‘œ

- **JPA Entity ì„¤ê³„**: ë„ë©”ì¸ ëª¨ë¸ì„ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆë¡œ ë§¤í•‘
- **ê³„ì¸µí˜• ì•„í‚¤í…ì²˜**: Controller â†’ Service â†’ Repository êµ¬ì¡° ì´í•´
- **ì‚¬ìš©ì ì¸í„°ë™ì…˜**: Inline Keyboardì™€ Callback Query ì²˜ë¦¬ íë¦„
- **ë°ì´í„° ì„¤ê³„**: í”¼ë“œë°± ë°ì´í„°ë¥¼ AI í•™ìŠµì— í™œìš©í•  ìˆ˜ ìˆëŠ” êµ¬ì¡° ì„¤ê³„
- **í”¼ë“œë°± ë£¨í”„**: ìˆ˜ì§‘ â†’ ë¶„ì„ â†’ ê°œì„ ì˜ ì „ì²´ ì‚¬ì´í´ ì´í•´

---

## ì™œ í”¼ë“œë°±ì¸ê°€?

### AI ì‹œìŠ¤í…œì˜ ì„±ì¥ ë£¨í”„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚   ì‚¬ìš©ì ê²€ìƒ‰ â”€â”€â–¶ ê²°ê³¼ í‘œì‹œ â”€â”€â–¶ í”¼ë“œë°± ìˆ˜ì§‘              â”‚
â”‚       â–²                                    â”‚            â”‚
â”‚       â”‚                                    â–¼            â”‚
â”‚   ë” ë‚˜ì€ ê²½í—˜ â—€â”€â”€ AI ëª¨ë¸ ê°œì„  â—€â”€â”€ ë°ì´í„° ë¶„ì„          â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**í”¼ë“œë°±ì´ ì¤‘ìš”í•œ ì´ìœ :**
1. **ê°ê´€ì  í’ˆì§ˆ ì§€í‘œ**: ì‚¬ìš©ìê°€ ì‹¤ì œë¡œ ë§Œì¡±í•˜ëŠ”ì§€ ì¸¡ì •
2. **ì§€ì†ì  ê°œì„ **: ì‹œìŠ¤í…œì„ ì‚¬ìš©í• ìˆ˜ë¡ ë” ë˜‘ë˜‘í•´ì§
3. **ê°œì¸í™” ê¸°ë°˜**: ì‚¬ìš©ìë³„ ì„ í˜¸ë„ í•™ìŠµ ê°€ëŠ¥
4. **A/B í…ŒìŠ¤íŠ¸**: ê°œì„  íš¨ê³¼ë¥¼ ì •ëŸ‰ì ìœ¼ë¡œ ê²€ì¦

### ì‹¤ë¬´ ì‚¬ë¡€

| ì„œë¹„ìŠ¤ | í”¼ë“œë°± í™œìš© |
|--------|-------------|
| **Netflix** | ì‹œì²­ ì—¬ë¶€ë¡œ ì¶”ì²œ ì•Œê³ ë¦¬ì¦˜ ê°œì„  |
| **YouTube** | í´ë¦­ë¥ , ì‹œì²­ ì‹œê°„ìœ¼ë¡œ ì¶”ì²œ ìµœì í™” |
| **Google ê²€ìƒ‰** | í´ë¦­ ì—¬ë¶€ë¡œ ê²€ìƒ‰ ìˆœìœ„ ê°œì„  |
| **Amazon** | êµ¬ë§¤ ì—¬ë¶€ë¡œ ìƒí’ˆ ì¶”ì²œ ê°œì„  |

---

## ì „ì²´ ì•„í‚¤í…ì²˜

### ì‹œìŠ¤í…œ êµ¬ì¡°ë„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Telegram User                         â”‚
â”‚                    (ê²€ìƒ‰ ê²°ê³¼ í™•ì¸ í›„)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ í´ë¦­: ğŸ‘ ë„ì›€ì´ ë¨
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Inline Keyboard (ë²„íŠ¼ UI)                   â”‚
â”‚  [ğŸ‘ ë„ì›€ì´ ë¨] [ğŸ‘ ë„ì›€ì´ ì•ˆë¨]  [âœ… ê´€ë ¨ ìˆìŒ] [âŒ ê´€ë ¨ ì—†ìŒ]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ Callback Query ì „ì†¡
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CallbackQueryHandler                          â”‚
â”‚  1. Callback ë°ì´í„° ìˆ˜ì‹                                    â”‚
â”‚  2. ë°ì´í„° íŒŒì‹± (query, bookId, type)                     â”‚
â”‚  3. FeedbackService í˜¸ì¶œ                                   â”‚
â”‚  4. ê°ì‚¬ ë©”ì‹œì§€ ì „ì†¡                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                FeedbackService                             â”‚
â”‚  â€¢ í”¼ë“œë°± ì €ì¥                                             â”‚
â”‚  â€¢ í†µê³„ ê³„ì‚°                                               â”‚
â”‚  â€¢ ì‚¬ìš©ìë³„ ì¡°íšŒ                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                â”‚
                   â–¼                â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Repository      â”‚  â”‚  AI Improvement  â”‚
        â”‚  (DB ì €ì¥)       â”‚  â”‚  Services        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â€¢ ê²€ìƒ‰ ì¬ì •ë ¬    â”‚
                               â”‚  â€¢ ê°œì¸í™”        â”‚
                               â”‚  â€¢ í”„ë¡¬í”„íŠ¸ ê°œì„  â”‚
                               â”‚  â€¢ í’ˆì§ˆ ë¶„ì„     â”‚
                               â”‚  â€¢ A/B í…ŒìŠ¤íŠ¸     â”‚
                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë°ì´í„° íë¦„ë„

```
1. ì‚¬ìš©ìê°€ ê²€ìƒ‰ â†’ ê²°ê³¼ í‘œì‹œ + Inline Keyboard
                    â†“
2. ì‚¬ìš©ìê°€ ë²„íŠ¼ í´ë¦­ â†’ Callback Query ì „ì†¡
                    â†“
3. CallbackHandler ìˆ˜ì‹  â†’ ë°ì´í„° íŒŒì‹±
                    â†“
4. FeedbackService â†’ DB ì €ì¥
                    â†“
5. ì €ì¥ëœ í”¼ë“œë°± â†’ ë¶„ì„ ë° AI ê°œì„ ì— í™œìš©
                    â†“
6. ë‹¤ìŒ ê²€ìƒ‰ ì‹œ â†’ ê°œì„ ëœ ê²°ê³¼ ì œê³µ
```

### ê³„ì¸µë³„ ì—­í• 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Presentation Layer                                â”‚
â”‚  â€¢ Inline Keyboard: ì‚¬ìš©ì ë²„íŠ¼ UI                 â”‚
â”‚  â€¢ CallbackQueryHandler: Callback ì²˜ë¦¬             â”‚
â”‚  â€¢ Admin API: ê´€ë¦¬ììš© ì¡°íšŒ/í†µê³„                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Business Layer                                    â”‚
â”‚  â€¢ FeedbackService: í”¼ë“œë°± ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§           â”‚
â”‚  â€¢ FeedbackAwareRankingService: ì¬ì •ë ¬            â”‚
â”‚  â€¢ PersonalizedRecommendationService: ê°œì¸í™”      â”‚
â”‚  â€¢ FeedbackEnhancedAiPromptService: í”„ë¡¬í”„íŠ¸ ê°œì„  â”‚
â”‚  â€¢ SearchQualityAnalyticsService: í’ˆì§ˆ ë¶„ì„       â”‚
â”‚  â€¢ FeedbackAbTestService: A/B í…ŒìŠ¤íŠ¸               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Data Access Layer                                 â”‚
â”‚  â€¢ SearchFeedbackRepository: DB CRUD               â”‚
â”‚  â€¢ SearchFeedback Entity: ë°ì´í„° ëª¨ë¸              â”‚
â”‚  â€¢ FeedbackRequest/Stats: ë°ì´í„° ì „ì†¡ ê°ì²´         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## í•µì‹¬ ê°œë…

### 1. í”¼ë“œë°± ë°ì´í„° ëª¨ë¸

**ìˆ˜ì§‘í•  ì •ë³´:**
- **ëˆ„ê°€**: Chat ID (ì‚¬ìš©ì ì‹ë³„)
- **ë¬´ì—‡ì„**: ê²€ìƒ‰ì–´, ë„ì„œ ID
- **ì–´ë–»ê²Œ**: í”¼ë“œë°± íƒ€ì… (ê¸ì •/ë¶€ì •)
- **ì–¸ì œ**: íƒ€ì„ìŠ¤íƒ¬í”„

**í”¼ë“œë°± íƒ€ì…:**
```
ğŸ‘ ì¢‹ì•˜ìŒ (GOOD)   â†’ ê²€ìƒ‰ ê²°ê³¼ê°€ ë§ˆìŒì— ë“¤ìŒ  (+1ì )
ğŸ‘ ë³„ë¡œì˜€ìŒ (BAD)  â†’ ê²€ìƒ‰ ê²°ê³¼ê°€ ë³„ë¡œì˜€ìŒ    (-1ì )
```

**ì„¤ê³„ ì´ìœ :**
- ë‹¨ìˆœëª…ë£Œ: ì‚¬ìš©ìê°€ ê³ ë¯¼í•  í•„ìš” ì—†ì´ ë°”ë¡œ í´ë¦­
- ëª…í™•í•œ ì ìˆ˜í™”: ê¸ì • +1, ë¶€ì • -1ë¡œ ê³„ì‚° ë‹¨ìˆœ
- ì‹¤ë¬´ í‘œì¤€: Reddit, Hacker News ë“± ë§ì€ ì„œë¹„ìŠ¤ê°€ ì´ ë°©ì‹ ì‚¬ìš©

### 2. Inline Keyboard

**Inline Keyboardë€ ë¬´ì—‡ì¸ê°€ìš”?**

Telegramì˜ **ë²„íŠ¼ í˜•íƒœ UI**ë¡œ, ì‚¬ìš©ìê°€ í´ë¦­í•˜ë©´ Botì— Callback(ì½œë°±) ì‹ í˜¸ê°€ ì „ë‹¬ë©ë‹ˆë‹¤.

ì›¹ì‚¬ì´íŠ¸ì˜ ë²„íŠ¼ì„ ìƒê°í•˜ë©´ ì‰½ìŠµë‹ˆë‹¤:
- ì›¹ì‚¬ì´íŠ¸: `<button onclick="handleClick()">í´ë¦­</button>`
- Telegram: `InlineKeyboardButton(callbackData="feedback:123")`

**ì™œ Inline Keyboardë¥¼ ì‚¬ìš©í•˜ë‚˜ìš”?**

1. **ì‚¬ìš©ì ì¹œí™”ì **: í…ìŠ¤íŠ¸ë¥¼ ì§ì ‘ ì…ë ¥í•  í•„ìš” ì—†ì´ ë²„íŠ¼ í´ë¦­ë§Œìœ¼ë¡œ ë™ì‘
2. **ì…ë ¥ ì˜¤ë¥˜ ë°©ì§€**: "/search í•´ë¦¬í¬í„°" ê°™ì€ ëª…ë ¹ì–´ë¥¼ í‹€ë¦¬ì§€ ì•Šê³  ë²„íŠ¼ìœ¼ë¡œ ì •í™•í•˜ê²Œ ì „ë‹¬
3. **ì‹¤ì‹œê°„ í”¼ë“œë°±**: í´ë¦­ ì¦‰ì‹œ Botì´ ì‘ë‹µí•˜ê³  ë©”ì‹œì§€ë¥¼ ìˆ˜ì • ê°€ëŠ¥

---

**Markdown ë§í¬ vs Inline Keyboard ë¹„êµ**

í˜„ì¬ Botì—ì„œ ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ Markdown ë§í¬ì™€ ë¹„êµí•´ë³´ê² ìŠµë‹ˆë‹¤:

| êµ¬ë¶„ | Markdown ë§í¬ | Inline Keyboard |
|------|---------------|-----------------|
| **ìš©ë„** | ì›¹ì‚¬ì´íŠ¸ë¡œ ì´ë™ | Botì— ì‹ í˜¸ ì „ë‹¬ |
| **ì˜ˆì‹œ** | `ğŸ”— ìƒì„¸ ë³´ê¸°: [ë§í¬](https://...)` | `[ğŸ‘ ë„ì›€ì´ ë¨] ë²„íŠ¼` |
| **ë™ì‘** | ì™¸ë¶€ ë¸Œë¼ìš°ì € ì—´ë¦¼ | Bot ë‚´ì—ì„œ ì²˜ë¦¬ |
| **Bot ìˆ˜ì‹ ** | ìˆ˜ì‹  ë¶ˆê°€ (ì‚¬ìš©ìê°€ ë¸Œë¼ìš°ì €ë¡œ ì´ë™) | `hasCallbackQuery()`ë¡œ ê°ì§€ |
| **ì‚¬ìš© ì‚¬ë¡€** | ë„ì„œ ìƒì„¸ í˜ì´ì§€ ë³´ê¸° | í”¼ë“œë°± ì „ì†¡, ëª…ë ¹ ì‹¤í–‰ |

**ì‹¤ì œ ì½”ë“œ ì˜ˆì‹œ:**

```java
// 1. Markdown ë§í¬ (í˜„ì¬ ì‚¬ìš© ì¤‘)
String message = "ğŸ”— ìƒì„¸ ë³´ê¸°: https://library.java21.net/books/123";
SendMessage(msg).text(message).build();
// â†’ ì‚¬ìš©ìê°€ í´ë¦­í•˜ë©´ ì›¹ë¸Œë¼ìš°ì €ê°€ ì—´ë¦¼

// 2. Inline Keyboard (ì´ë²ˆì— ì¶”ê°€)
InlineKeyboardButton button = InlineKeyboardButton.builder()
    .text("ğŸ‘ ë„ì›€ì´ ë¨")
    .callbackData("feedback:í•´ë¦¬í¬í„°:123:HELPFUL")
    .build();
// â†’ ì‚¬ìš©ìê°€ í´ë¦­í•˜ë©´ Botì´ callbackDataë¥¼ ìˆ˜ì‹ 
```

---

**Inline Keyboard ì‘ë™ ë°©ì‹**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ì‚¬ìš©ì í™”ë©´ (Telegram App)          â”‚
â”‚                                             â”‚
â”‚  Bot: ê²€ìƒ‰ ê²°ê³¼ê°€ ë„ì›€ì´ ë˜ì…¨ë‚˜ìš”?           â”‚
â”‚                                             â”‚
â”‚  [ğŸ‘ ë„ì›€ì´ ë¨] [ğŸ‘ ë„ì›€ì´ ì•ˆë¨]  â† ë²„íŠ¼    â”‚
â”‚  [âœ… ê´€ë ¨ ìˆìŒ] [âŒ ê´€ë ¨ ì—†ìŒ]  â† Inline     â”‚
â”‚           Keyboard                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ ì‚¬ìš©ìê°€ ë²„íŠ¼ í´ë¦­
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Telegram ì„œë²„                      â”‚
â”‚  callbackData: "feedback:í•´ë¦¬í¬í„°:123:HELPUL" â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ Callback Query ì „ì†¡
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           LibraryTelegramBot                â”‚
â”‚  onUpdateReceived(Update) í˜¸ì¶œ              â”‚
â”‚  update.hasCallbackQuery() == true          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ CallbackQueryHandler ì²˜ë¦¬
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ë°ì´í„° íŒŒì‹± ë° ì €ì¥                  â”‚
â”‚  query = "í•´ë¦¬í¬í„°"                         â”‚
â”‚  bookId = 123                               â”‚
â”‚  type = HELPFUL                             â”‚
â”‚  â†’ DB ì €ì¥                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**ì¼ë°˜ ë©”ì‹œì§€ì™€ì˜ ì°¨ì´**

| êµ¬ë¶„ | ì¼ë°˜ ë©”ì‹œì§€ | Inline Keyboard |
|------|-------------|-----------------|
| **ì‚¬ìš©ì ì…ë ¥** | í…ìŠ¤íŠ¸ ì§ì ‘ ì…ë ¥ | ë²„íŠ¼ í´ë¦­ |
| **Bot ìˆ˜ì‹  ë©”ì„œë“œ** | `hasMessage()` | `hasCallbackQuery()` |
| **ì‘ë‹µ ë°©ì‹** | `SendMessage` (ìƒˆ ë©”ì‹œì§€) | `EditMessageText` (ê¸°ì¡´ ë©”ì‹œì§€ ìˆ˜ì •) |
| **ì˜ˆì‹œ** | User: "í•´ë¦¬í¬í„°" ì…ë ¥ | User: [ğŸ‘ ì¢‹ì•˜ìŒ] í´ë¦­ |

---

**ì°¸ê³  ìë£Œ**

Telegram Bot ê³µì‹ ë¬¸ì„œ:
- [Inline Keyboards](https://core.telegram.org/bots/features#inline-keyboards)
- [InlineKeyboardMarkup](https://core.telegram.org/bots/api#inlinekeyboardmarkup)
- [Callback Query](https://core.telegram.org/bots/api#callbackquery)

Java ë¼ì´ë¸ŒëŸ¬ë¦¬ (telegram-bot):
- [TelegramBots GitHub](https://github.com/rubenlagus/TelegramBots)

### 3. Callback ë°ì´í„° ì„¤ê³„

ë²„íŠ¼ ì‹ë³„ì„ ìœ„í•œ ë°ì´í„° í¬ë§·:

**í¬ë§·:**
```
feedback:{query}:{bookId}:{type}

ì˜ˆ: feedback:í•´ë¦¬í¬í„°:123:GOOD
```

**ê³ ë ¤ì‚¬í•­:**
- íŠ¹ìˆ˜ë¬¸ì ì²˜ë¦¬ (`:` â†’ URL ì¸ì½”ë”© í•„ìš”)
- íŒŒì‹± ìš©ì´ì„±
- í™•ì¥ì„± (ë‹¤ë¥¸ íƒ€ì…ì˜ Callback ì¶”ê°€ ê°€ëŠ¥)

---

### 4. í”¼ë“œë°± UI ì„¤ê³„

**ì¤‘ìš”í•œ ì„¤ê³„ ê²°ì •: ê°œë³„ ë„ì„œë³„ í”¼ë“œë°±**

ê° ê²€ìƒ‰ ê²°ê³¼ ë„ì„œë§ˆë‹¤ ë³„ë„ì˜ í”¼ë“œë°± ë²„íŠ¼ì„ ì œê³µí•©ë‹ˆë‹¤:

```
Bot: ğŸ“š "í•´ë¦¬í¬í„°" ê²€ìƒ‰ ê²°ê³¼ (5ê¶Œ)

     1. í•´ë¦¬í¬í„°ì™€ ë§ˆë²•ì‚¬ì˜ ëŒ
        [ğŸ‘ ì¢‹ì•˜ìŒ] [ğŸ‘ ë³„ë¡œì˜€ìŒ]

     2. í•´ë¦¬í¬í„°ì™€ ë¹„ë°€ì˜ ë°©
        [ğŸ‘ ì¢‹ì•˜ìŒ] [ğŸ‘ ë³„ë¡œì˜€ìŒ]
```

**ì™œ ê°œë³„ ë„ì„œë³„ì¸ê°€?**
1. **ë” ì •ë°€í•œ í”¼ë“œë°±**: "ì²« ë²ˆì§¸ ì±…ì€ ì¢‹ì•˜ëŠ”ë°, ë‘ ë²ˆì§¸ ì±…ì€ ë³„ë¡œì˜€ì–´"
2. **AI ê°œì„ ì— í™œìš©**: í”¼ë“œë°±ì´ ë§ì€ ë„ì„œë¥¼ ìƒìœ„ í‘œì‹œ (Learning to Rank)
3. **ê°œì¸í™” ê°€ëŠ¥**: ì‚¬ìš©ìê°€ "íŒíƒ€ì§€" ì¢‹ì•„í•˜ëŠ” íŒ¨í„´ í•™ìŠµ

**ë°ì´í„° ì €ì¥ ì˜ˆì‹œ:**
```
ë„ì„œ 1ì— ğŸ‘ í´ë¦­ â†’ bookId = 1, type = GOOD
ë„ì„œ 2ì— ğŸ‘ í´ë¦­ â†’ bookId = 2, type = BAD
```

---

## ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„

### ERD

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             search_feedbacks                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  id           (PK)          BIGINT          â”‚
â”‚  chat_id      (NOT NULL)   BIGINT           â”‚
â”‚  query        (NOT NULL)   VARCHAR(500)     â”‚
â”‚  book_id                    BIGINT          â”‚
â”‚  type         (NOT NULL)   VARCHAR(20)      â”‚
â”‚  created_at   (NOT NULL)   TIMESTAMP        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  INDEX: idx_chat_id                         â”‚
â”‚  INDEX: idx_created_at                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### í•„ë“œ ìƒì„¸ ì„¤ëª…

| ì»¬ëŸ¼ëª… | íƒ€ì… | NULL | ì„¤ëª… | ì˜ˆì‹œ |
|--------|------|------|------|------|
| **id** | BIGINT | NOT NULL | ê¸°ë³¸í‚¤ (PK) | 1, 2, 3, ... |
| **chat_id** | BIGINT | NOT NULL | Telegram ì‚¬ìš©ì ì‹ë³„ì | 123456789, 987654321 |
| **query** | VARCHAR(500) | NOT NULL | ì‚¬ìš©ì ê²€ìƒ‰ì–´ | "í•´ë¦¬í¬í„°", "ì£¼ì‹ íˆ¬ì" |
| **book_id** | BIGINT | NULL | í”¼ë“œë°± ëŒ€ìƒ ë„ì„œ ID | 101, 205, NULL (ì „ì²´ í”¼ë“œë°±) |
| **type** | VARCHAR(20) | NOT NULL | í”¼ë“œë°± ìœ í˜• | GOOD, BAD |
| **created_at** | TIMESTAMP | NOT NULL | í”¼ë“œë°± ìƒì„± ì‹œê°„ | 2025-01-15 14:30:25 |

**í•„ë“œë³„ ìƒì„¸ ì„¤ëª…:**

| í•„ë“œ | ì˜ë¯¸ | ì‚¬ìš© ì˜ˆì‹œ |
|------|------|----------|
| **id** | í”¼ë“œë°± ê³ ìœ  ë²ˆí˜¸ (ìë™ ì¦ê°€) | DBê°€ ìë™ ë¶€ì—¬ |
| **chat_id** | Telegram ì‚¬ìš©ì ê³ ìœ  ID. ê°™ì€ ì‚¬ìš©ìì¸ì§€ ì‹ë³„ | 123456789 = ì² ìˆ˜, 987654321 = ì˜í¬ |
| **query** | ì‚¬ìš©ìê°€ ì…ë ¥í•œ ê²€ìƒ‰ì–´. URL ì¸ì½”ë”©ëœ ìƒíƒœë¡œ ì €ì¥ | "í•´ë¦¬í¬í„°", "Java%20%EB%B0%B1%EC%97%94%EB%93%9C" |
| **book_id** | í”¼ë“œë°±ì„ ì¤€ ë„ì„œ ID. íŠ¹ì • ë„ì„œë¥¼ ì§€ì • | 101 = "í•´ë¦¬í¬í„°ì™€ ë§ˆë²•ì‚¬ì˜ ëŒ" |
| **type** | í”¼ë“œë°± ì¢…ë¥˜. ê¸ì •/ë¶€ì • ìœ í˜• | GOOD = ì¢‹ì•˜ìŒ(+1ì ), BAD = ë³„ë¡œì˜€ìŒ(-1ì ) |
| **created_at** | í”¼ë“œë°±ì´ ì €ì¥ëœ ì‹œê°„. ìë™ ìƒì„± | "2025-01-15 14:30:25" |

---

### SQL DDL

**MySQL/MariaDB:**
```sql
CREATE TABLE search_feedbacks (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    chat_id BIGINT NOT NULL,
    query VARCHAR(500) NOT NULL,
    book_id BIGINT,
    type VARCHAR(20) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_chat_id (chat_id),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

**H2 (ê°œë°œìš©):**
```sql
CREATE TABLE search_feedbacks (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    chat_id BIGINT NOT NULL,
    query VARCHAR(500) NOT NULL,
    book_id BIGINT,
    type VARCHAR(20) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_chat_id (chat_id),
    INDEX idx_created_at (created_at)
);
```

**PostgreSQL:**
```sql
CREATE TABLE search_feedbacks (
    id BIGSERIAL PRIMARY KEY,
    chat_id BIGINT NOT NULL,
    query VARCHAR(500) NOT NULL,
    book_id BIGINT,
    type VARCHAR(20) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_chat_id (chat_id),
    INDEX idx_created_at (created_at)
);
```

---

### ì˜ˆì‹œ ë°ì´í„°

**ì‹¤ì œ ì €ì¥ë˜ëŠ” ë°ì´í„° ì˜ˆì‹œ:**

```
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id â”‚  chat_id  â”‚    query     â”‚ book_id â”‚     type      â”‚     created_at      â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1 â”‚ 123456789 â”‚ í•´ë¦¬í¬í„°     â”‚     101 â”‚ GOOD          â”‚ 2025-01-15 14:30:25 â”‚
â”‚  2 â”‚ 123456789 â”‚ í•´ë¦¬í¬í„°     â”‚     102 â”‚ BAD           â”‚ 2025-01-15 14:31:10 â”‚
â”‚  3 â”‚ 987654321 â”‚ ì£¼ì‹ íˆ¬ì    â”‚     205 â”‚ GOOD          â”‚ 2025-01-15 15:20:05 â”‚
â”‚  4 â”‚ 123456789 â”‚ Java ë°±ì—”ë“œ  â”‚     310 â”‚ GOOD          â”‚ 2025-01-15 16:45:30 â”‚
â”‚  5 â”‚ 987654321 â”‚ ì£¼ì‹ íˆ¬ì    â”‚     205 â”‚ BAD           â”‚ 2025-01-15 17:10:15 â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ë°ì´í„° ë¶„ì„ ì˜ˆì‹œ:**

| ì§ˆë¬¸ | SQL ì˜ˆì‹œ | ê²°ê³¼ |
|------|----------|------|
| "í•´ë¦¬í¬í„°" ê²€ìƒ‰ì— ëŒ€í•œ ê¸ì • í”¼ë“œë°± ìˆ˜? | `SELECT COUNT(*) FROM search_feedbacks WHERE query='í•´ë¦¬í¬í„°' AND type='GOOD'` | 1ê±´ |
| ë„ì„œ ID 101ì— ëŒ€í•œ í”¼ë“œë°± ì ìˆ˜? | `(ê¸ì • 1ê±´ - ë¶€ì • 0ê±´) / 1ê±´ = 1.0 (100% ê¸ì •)` | +0.5 ë³´ë„ˆìŠ¤ |
| ì² ìˆ˜(chatId=123456789)ê°€ ì¢‹ì•„í•œ ë„ì„œ? | `SELECT book_id FROM search_feedbacks WHERE chat_id=123456789 AND type='GOOD'` | 101, 310 |
| ìµœê·¼ 7ì¼ê°„ ê¸ì • í”¼ë“œë°± ë¹„ìœ¨? | `ê¸ì • 3ê±´ / ì „ì²´ 5ê±´ = 60%` | 60% |

**ì‹¤ì œ ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤:**

```
ì‹œë‚˜ë¦¬ì˜¤: ì² ìˆ˜ê°€ "í•´ë¦¬í¬í„°"ë¥¼ ê²€ìƒ‰í•˜ê³  í”¼ë“œë°±ì„ ë‚¨ê¹€

1. ê²€ìƒ‰: User(chatId=123456789) â†’ "í•´ë¦¬í¬í„°" ê²€ìƒ‰
2. ê²°ê³¼: 3ê¶Œì˜ ë„ì„œ í‘œì‹œ (ID: 101, 102, 103)
3. í”¼ë“œë°±:
   - ë„ì„œ 101: [ğŸ‘ ì¢‹ì•˜ìŒ] í´ë¦­
   - ë„ì„œ 102: [ğŸ‘ ë³„ë¡œì˜€ìŒ] í´ë¦­
4. DB ì €ì¥:
   INSERT INTO search_feedbacks (chat_id, query, book_id, type, created_at)
   VALUES (123456789, 'í•´ë¦¬í¬í„°', 101, 'GOOD', '2025-01-15 14:30:25');

   INSERT INTO search_feedbacks (chat_id, query, book_id, type, created_at)
   VALUES (123456789, 'í•´ë¦¬í¬í„°', 102, 'BAD', '2025-01-15 14:31:10');
5. AI í™œìš©:
   - ë„ì„œ 101: ê¸ì • í”¼ë“œë°± â†’ ë‹¤ìŒ ê²€ìƒ‰ ì‹œ ìƒìœ„ í‘œì‹œ
   - ë„ì„œ 102: ë¶€ì • í”¼ë“œë°± â†’ ë‹¤ìŒ ê²€ìƒ‰ ì‹œ í•˜ìœ„ í‘œì‹œ
```

---

### JPA Entity ì„¤ê³„ í¬ì¸íŠ¸

**í•„ìš”í•œ ì–´ë…¸í…Œì´ì…˜:**
- `@Entity` - JPA Entityì„ì„ ëª…ì‹œ
- `@Table` - í…Œì´ë¸”ëª…ê³¼ ì¸ë±ìŠ¤ ì„¤ì •
- `@Id` + `@GeneratedValue` - ê¸°ë³¸í‚¤ ì„¤ì •
- `@Enumerated(EnumType.STRING)` - Enumì„ ë¬¸ìì—´ë¡œ ì €ì¥
- `@PrePersist` - ì €ì¥ ì „ ìë™ìœ¼ë¡œ created_at ì„¤ì •

**êµ¬í˜„ ê°€ì´ë“œ:**
- ì¸ë±ìŠ¤: chat_id, created_at (ì¡°íšŒ ì„±ëŠ¥)
- Enum: String íƒ€ì…ìœ¼ë¡œ ì €ì¥ (ê°€ë…ì„±)
- @PrePersist: ìƒì„± ì‹œê°„ ìë™ ì„¤ì •

---

## êµ¬í˜„ ê°€ì´ë“œ

### Phase 1: Entityì™€ Repository
### Phase 1: Entityì™€ Repository

**ëª©í‘œ:** í”¼ë“œë°± ë°ì´í„°ë¥¼ ì €ì¥í•  ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡° ë§Œë“¤ê¸°

**êµ¬í˜„í•´ì•¼ í•  ê²ƒ:**

**1. `FeedbackType` Enum**
- GOOD(1, "ì¢‹ì•˜ìŒ"), BAD(-1, "ë³„ë¡œì˜€ìŒ") ì •ì˜
- `getScoreValue()` ë©”ì„œë“œë¡œ ì ìˆ˜ ë°˜í™˜ (+1, -1)

**2. `SearchFeedback` Entity**
- í•„ë“œ: id, chatId, query, bookId, type(FeedbackType), createdAt
- ì–´ë…¸í…Œì´ì…˜: @Entity, @Table(name="search_feedbacks"), @Index
- @PrePersist: createdAt ìë™ ì„¤ì •

**3. `SearchFeedbackRepository` ì¸í„°í˜ì´ìŠ¤**
- Spring Data JPA ìƒì†
- ì¿¼ë¦¬ ë©”ì„œë“œ:
  - `findByChatIdOrderByCreatedAtDesc(Long chatId)` - íŠ¹ì • ì‚¬ìš©ì í”¼ë“œë°±
  - `findByBookId(Long bookId)` - íŠ¹ì • ë„ì„œì˜ ëª¨ë“  í”¼ë“œë°±
  - `findByQuery(String query)` - íŠ¹ì • ê²€ìƒ‰ì–´ í”¼ë“œë°±

**ì²˜ë¦¬ íë¦„:**
```
í”¼ë“œë°± ìƒì„± â†’ Entity ë§¤í•‘ â†’ Repository â†’ DB ì €ì¥
```

**í•™ìŠµ í¬ì¸íŠ¸:**
- JPA ì–´ë…¸í…Œì´ì…˜ (@Entity, @Table, @Index, @Enumerated)
- Enumì„ Stringìœ¼ë¡œ ì €ì¥í•˜ëŠ” ì´ìœ  (ê°€ë…ì„±)
- @PrePersistë¡œ ìƒì„± ì‹œê°„ ìë™ ì„¤ì •
- Spring Data JPA ë©”ì„œë“œ ë„¤ì´ë° ê·œì¹™

---

### Phase 2: DTOì™€ Service

**ëª©í‘œ:** ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ ë°ì´í„° ì „ì†¡ ê°ì²´ ë§Œë“¤ê¸°

**êµ¬í˜„í•´ì•¼ í•  ê²ƒ:**

**1. `FeedbackRequest` DTO (record)**
- í•„ë“œ: query(@NotBlank), bookId(@NotNull), type(@NotNull)
- ì—­í• : í”¼ë“œë°± ìš”ì²­ ë°ì´í„° ì „ë‹¬, ìœ íš¨ì„± ê²€ì‚¬

**2. `FeedbackStats` DTO (record)**
- í•„ë“œ: goodCount, badCount, totalCount, goodRatio, feedbackScore
- ë©”ì„œë“œ: `from(List<SearchFeedback>)` - Stream APIë¡œ í†µê³„ ê³„ì‚°
- ì ìˆ˜ ê³„ì‚°: (ê¸ì • - ë¶€ì •) / ì „ì²´
- ì˜ˆ: GOOD 15ê±´, BAD 2ê±´ â†’ (15-2)/17 = 0.76

**3. `FeedbackService` ì¸í„°í˜ì´ìŠ¤**
- `recordFeedback(FeedbackRequest)` - í”¼ë“œë°± ì €ì¥
- `getUserFeedback(Long chatId)` - ì‚¬ìš©ìë³„ í”¼ë“œë°± ëª©ë¡
- `getBookFeedbackStats(Long bookId)` - ë„ì„œë³„ í†µê³„
- `getQueryFeedbackStats(String query)` - ê²€ìƒ‰ì–´ë³„ í†µê³„
- `getRecentFeedback(int days)` - ìµœê·¼ Nì¼ í”¼ë“œë°±

**4. `FeedbackServiceImpl` êµ¬í˜„**
- @Transactional íŠ¸ëœì­ì…˜ ì²˜ë¦¬
- Repository í˜¸ì¶œí•˜ì—¬ DB ì €ì¥
- Stream APIë¡œ í†µê³„ ê³„ì‚°

**ì²˜ë¦¬ íë¦„:**
```
Request DTO â†’ Service â†’ Repository â†’ DB
              â†“
         Stats ê³„ì‚° â†’ Stats DTO ë°˜í™˜
```

**í•™ìŠµ í¬ì¸íŠ¸:**
- record í™œìš© (ë¶ˆë³€ ê°ì²´)
- Validation ì–´ë…¸í…Œì´ì…˜ (@NotNull, @NotBlank)
- @Transactional (readOnly ìµœì í™”)
- Stream APIë¡œ ë°ì´í„° ì§‘ê³„

---

### Phase 3: Inline Keyboard Factory

**ëª©í‘œ:** ë²„íŠ¼ UI ìƒì„± ë¡œì§ ë§Œë“¤ê¸°

**êµ¬í˜„í•´ì•¼ í•  ê²ƒ:**

**`TelegramKeyboardFactory` í´ë˜ìŠ¤**
- `createFeedbackKeyboard(String query, Long bookId)` ë©”ì„œë“œ
  - ê²€ìƒ‰ì–´ URL ì¸ì½”ë”© (ê³µë°±, í•œê¸€ ì²˜ë¦¬)
  - InlineKeyboardButton 2ê°œ ìƒì„± (ì¢‹ì•˜ìŒ, ë³„ë¡œì˜€ìŒ)
  - InlineKeyboardMarkup.builder()ë¡œ Keyboard ì¡°ë¦½
  - callbackData í¬ë§·: `feedback:{query}:{bookId}:{type}`
  - ì˜ˆ: `feedback:í•´ë¦¬í¬í„°:123:GOOD`

**UI ë ˆì´ì•„ì›ƒ:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ğŸ‘ ì¢‹ì•˜ìŒ] [ğŸ‘ ë³„ë¡œì˜€ìŒ]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì²˜ë¦¬ íë¦„:**
```
ê²€ìƒ‰ì–´ ì…ë ¥ â†’ URL ì¸ì½”ë”© â†’ Keyboard ìƒì„± â†’ ë²„íŠ¼ì— Callback ë°ì´í„° ì—°ê²°
```

**í•™ìŠµ í¬ì¸íŠ¸:**
- Builder íŒ¨í„´ìœ¼ë¡œ Keyboard ìƒì„±
- URL ì¸ì½”ë”©ìœ¼ë¡œ íŠ¹ìˆ˜ë¬¸ì ì²˜ë¦¬
- Callback ë°ì´í„° í¬ë§· ì„¤ê³„ (ì½œë¡ (:)ìœ¼ë¡œ êµ¬ë¶„)

---

### Phase 4: Callback Handler

**ëª©í‘œ:** ë²„íŠ¼ í´ë¦­ ì²˜ë¦¬ ë¡œì§ ë§Œë“¤ê¸°

**êµ¬í˜„í•´ì•¼ í•  ê²ƒ:**

**`CallbackQueryHandler` í´ë˜ìŠ¤**
- `handleCallback(Update update)` ë©”ì„œë“œ
  1. Callback ìœ í˜• í™•ì¸ (hasCallbackQuery)
  2. Callback ë°ì´í„° íŒŒì‹± (split(":"))
     - `feedback:í•´ë¦¬í¬í„°:123:GOOD` â†’ ["feedback", "í•´ë¦¬í¬í„°", "123", "GOOD"]
  3. URL ë””ì½”ë”©ìœ¼ë¡œ ê²€ìƒ‰ì–´ ë³µì›
  4. FeedbackRequest ìƒì„±
  5. FeedbackServiceë¡œ ì €ì¥
  6. EditMessageTextë¡œ ë©”ì‹œì§€ ìˆ˜ì • (ê°ì‚¬ ë©”ì‹œì§€)
  7. AnswerCallbackQueryë¡œ Telegramì— ì‘ë‹µ
  8. ì˜ˆì™¸ ì²˜ë¦¬ (IllegalArgumentException, ì¼ë°˜ Exception)

**ì²˜ë¦¬ íë¦„:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì‚¬ìš©ì í´ë¦­ â”‚ â†’  â”‚ Callback ìˆ˜ì‹  â”‚ â†’  â”‚  ë°ì´í„° íŒŒì‹±  â”‚ â†’  â”‚  DB ì €ì¥    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì™„ë£Œ ì‘ë‹µ   â”‚ â†  â”‚ ë©”ì‹œì§€ ìˆ˜ì •   â”‚ â†  â”‚ ê°ì‚¬ ë©”ì‹œì§€  â”‚ â†  â”‚ Telegram API â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**í•™ìŠµ í¬ì¸íŠ¸:**
- URL ë””ì½”ë”©ìœ¼ë¡œ íŠ¹ìˆ˜ë¬¸ì ë³µì›
- Enum ë³€í™˜ ì‹œ IllegalArgumentException ì²˜ë¦¬
- EditMessageTextë¡œ ê¸°ì¡´ ë©”ì‹œì§€ ìˆ˜ì •
- AnswerCallbackQueryë¡œ Telegramì— ì‘ë‹µ ì „ì†¡

            // 3. í”¼ë“œë°± ì €ì¥
            FeedbackRequest request = new FeedbackRequest(query, bookId, type);
            feedbackService.recordFeedback(request);

            // 4. ë©”ì‹œì§€ ìˆ˜ì • (ê°ì‚¬ ë©”ì‹œì§€)
            EditMessageText editMessage = EditMessageText.builder()
                .chatId(chatId)
                .messageId(callbackQuery.getMessage().getMessageId())
                .text("âœ… ì†Œì¤‘í•œ í”¼ë“œë°± ê°ì‚¬í•©ë‹ˆë‹¤!\nê²€ìƒ‰ í’ˆì§ˆ ê°œì„ ì— í™œìš©í•˜ê² ìŠµë‹ˆë‹¤.")
                .build();

            // execute(editMessage);

            // 5. Callback ì‘ë‹µ (Telegramì— ì „ì†¡ ì™„ë£Œ ì•Œë¦¼)
            AnswerCallbackQuery answer = AnswerCallbackQuery.builder()
                .callbackQueryId(callbackQuery.getId())
                .text("í”¼ë“œë°±ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.")
                .build();
            // execute(answer);

        } catch (IllegalArgumentException e) {
            log.error("Invalid callback data: {}", callbackData, e);
            sendErrorMessage(chatId, "í”¼ë“œë°± ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        } catch (Exception e) {
            log.error("Failed to process callback: {}", callbackData, e);
            sendErrorMessage(chatId, "í”¼ë“œë°± ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
    }

    private void sendErrorMessage(Long chatId, String text) {
        // ì—ëŸ¬ ë©”ì‹œì§€ ì „ì†¡ ë¡œì§
    }
}
```
**ì—­í• :** ë²„íŠ¼ í´ë¦­ ì‹œ Callback ì²˜ë¦¬

**ì²˜ë¦¬ íë¦„:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì‚¬ìš©ì í´ë¦­ â”‚ â†’  â”‚ Callback ìˆ˜ì‹  â”‚ â†’  â”‚  ë°ì´í„° íŒŒì‹±  â”‚ â†’  â”‚  DB ì €ì¥    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì™„ë£Œ ì‘ë‹µ   â”‚ â†  â”‚ ë©”ì‹œì§€ ìˆ˜ì •   â”‚ â†  â”‚ ê°ì‚¬ ë©”ì‹œì§€  â”‚ â†  â”‚ Telegram API â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**í•™ìŠµ í¬ì¸íŠ¸:**
- URL ë””ì½”ë”©ìœ¼ë¡œ íŠ¹ìˆ˜ë¬¸ì ë³µì›
- Enum ë³€í™˜ ì‹œ IllegalArgumentException ì²˜ë¦¬
- EditMessageTextë¡œ ê¸°ì¡´ ë©”ì‹œì§€ ìˆ˜ì •
- AnswerCallbackQueryë¡œ Telegramì— ì‘ë‹µ ì „ì†¡

---

### Phase 5: Bot ì—°ë™

**ëª©í‘œ:** ê¸°ì¡´ Botì— í”¼ë“œë°± ê¸°ëŠ¥ í†µí•©

**ìˆ˜ì •í•´ì•¼ í•  ê²ƒ:**

**1. `LibraryTelegramBot`ì— ì˜ì¡´ì„± ì¶”ê°€**
- CallbackQueryHandler ì£¼ì…
- TelegramKeyboardFactory ì£¼ì…

**2. `onUpdateReceived` ë©”ì„œë“œ ìˆ˜ì •**
- Callback Query ì²˜ë¦¬ë¥¼ ìµœìš°ì„ ìœ¼ë¡œ ë¶„ê¸°
- ì¼ë°˜ ë©”ì‹œì§€ëŠ” ê¸°ì¡´ ë¡œì§ëŒ€ë¡œ ì²˜ë¦¬
- ìš°ì„ ìˆœìœ„: Callback â†’ ì¼ë°˜ ë©”ì‹œì§€

**3. ê²€ìƒ‰ ê²°ê³¼ ì „ì†¡ ë©”ì„œë“œ ìˆ˜ì •**
- ë„ì„œ ì •ë³´ ì „ì†¡ ì‹œ Keyboard ìƒì„±
- SendMessage.builder()ì— .replyMarkup(keyboard) ì¶”ê°€
- ê° ë„ì„œë§ˆë‹¤ ê°œë³„ Keyboard ë¶€ì°©

**ì²˜ë¦¬ íë¦„:**
```
Update ìˆ˜ì‹  â†’ Callback í™•ì¸? â†’ YES: CallbackHandler ì²˜ë¦¬
                          â†’ NO: ê¸°ì¡´ ë©”ì‹œì§€ ì²˜ë¦¬
ê²€ìƒ‰ ê²°ê³¼ ì „ì†¡ â†’ Keyboard ìƒì„± â†’ replyMarkup ì„¤ì • â†’ ì „ì†¡
```

**í•™ìŠµ í¬ì¸íŠ¸:**
- ê¸°ì¡´ ì½”ë“œì— ìƒˆ ê¸°ëŠ¥ í†µí•© ë°©ë²•
- ìš°ì„ ìˆœìœ„ ê¸°ë°˜ ë¶„ê¸° ì²˜ë¦¬
- replyMarkupìœ¼ë¡œ Keyboard ë©”ì‹œì§€ì— ë¶€ì°©

---

### Phase 6: Admin API

**ëª©í‘œ:** ê´€ë¦¬ììš© ì¡°íšŒ/í†µê³„ API ë§Œë“¤ê¸°

**êµ¬í˜„í•´ì•¼ í•  ê²ƒ:**

**`FeedbackAdminController` í´ë˜ìŠ¤ (@RestController)**
- `GET /api/admin/feedback/stats?query=í•´ë¦¬í¬í„°`
  - íŠ¹ì • ê²€ìƒ‰ì–´ì˜ í”¼ë“œë°± í†µê³„ ì¡°íšŒ
  - @RequestParamìœ¼ë¡œ query ìˆ˜ì‹ 

- `GET /api/admin/feedback/recent?days=7`
  - ìµœê·¼ Nì¼ê°„ í”¼ë“œë°± ëª©ë¡ ì¡°íšŒ
  - @RequestParam(defaultValue="7")ë¡œ days ìˆ˜ì‹ 

- `GET /api/admin/feedback/user/{chatId}`
  - íŠ¹ì • ì‚¬ìš©ìì˜ í”¼ë“œë°± ëª©ë¡ ì¡°íšŒ
  - @PathVariableìœ¼ë¡œ chatId ìˆ˜ì‹ 

- `GET /api/admin/feedback/book/{bookId}`
  - íŠ¹ì • ë„ì„œì˜ í”¼ë“œë°± í†µê³„ ì¡°íšŒ
  - @PathVariableìœ¼ë¡œ bookId ìˆ˜ì‹ 

**API ì‘ë‹µ ì˜ˆì‹œ:**
```json
GET /api/admin/feedback/stats?query=í•´ë¦¬í¬í„°

{
  "goodCount": 15,
  "badCount": 2,
  "totalCount": 17,
  "goodRatio": 0.882,
  "feedbackScore": 0.764
}
```

**ì²˜ë¦¬ íë¦„:**
```
HTTP ìš”ì²­ â†’ Controller â†’ Service â†’ Repository â†’ DB
                 â†“
           ResponseEntity â† Stats DTO â† ë³€í™˜
```

**í•™ìŠµ í¬ì¸íŠ¸:**
- @GetMapping, @RequestParam, @PathVariable í™œìš©
- ResponseEntityë¡œ JSON ì‘ë‹µ
- REST API ì„¤ê³„ ì›ì¹™

**ëª©í‘œ:** ê´€ë¦¬ììš© ì¡°íšŒ/í†µê³„ API ë§Œë“¤ê¸°

**êµ¬í˜„í•´ì•¼ í•  ê²ƒ:**

**`FeedbackAdminController` í´ë˜ìŠ¤**
```java
@RestController
@RequestMapping("/api/admin/feedback")
@RequiredArgsConstructor
public class FeedbackAdminController {

    private final FeedbackService feedbackService;

    /**
     * íŠ¹ì • ê²€ìƒ‰ì–´ì˜ í”¼ë“œë°± í†µê³„ ì¡°íšŒ
     * GET /api/admin/feedback/stats?query=í•´ë¦¬í¬í„°
     */
    @GetMapping("/stats")
    public ResponseEntity<FeedbackStats> getQueryStats(@RequestParam String query) {
        FeedbackStats stats = feedbackService.getQueryFeedbackStats(query);
        return ResponseEntity.ok(stats);
    }

    /**
     * ìµœê·¼ Nì¼ê°„ í”¼ë“œë°± ëª©ë¡ ì¡°íšŒ
     * GET /api/admin/feedback/recent?days=7
     */
    @GetMapping("/recent")
    public ResponseEntity<List<SearchFeedback>> getRecentFeedback(
            @RequestParam(defaultValue = "7") int days) {
        List<SearchFeedback> feedbacks = feedbackService.getRecentFeedback(days);
        return ResponseEntity.ok(feedbacks);
    }

    /**
     * íŠ¹ì • ì‚¬ìš©ìì˜ í”¼ë“œë°± ëª©ë¡ ì¡°íšŒ
     * GET /api/admin/feedback/user/{chatId}
     */
    @GetMapping("/user/{chatId}")
    public ResponseEntity<List<SearchFeedback>> getUserFeedback(
            @PathVariable Long chatId) {
        List<SearchFeedback> feedbacks = feedbackService.getUserFeedback(chatId);
        return ResponseEntity.ok(feedbacks);
    }

    /**
     * íŠ¹ì • ë„ì„œì˜ í”¼ë“œë°± í†µê³„ ì¡°íšŒ
     * GET /api/admin/feedback/book/{bookId}
     */
    @GetMapping("/book/{bookId}")
    public ResponseEntity<FeedbackStats> getBookStats(@PathVariable Long bookId) {
        FeedbackStats stats = feedbackService.getBookFeedbackStats(bookId);
        return ResponseEntity.ok(stats);
    }
}
```
**ì—­í• :** ê´€ë¦¬ììš© í”¼ë“œë°± ì¡°íšŒ/í†µê³„ API ì œê³µ

**API ì‚¬ìš© ì˜ˆì‹œ:**
```bash
# í†µê³„ ì¡°íšŒ
curl "http://localhost:8080/api/admin/feedback/stats?query=í•´ë¦¬í¬í„°"

# ìµœê·¼ 7ì¼ í”¼ë“œë°±
curl "http://localhost:8080/api/admin/feedback/recent?days=7"

# ì‚¬ìš©ì í”¼ë“œë°±
curl "http://localhost:8080/api/admin/feedback/user/123456789"
```

**í•™ìŠµ í¬ì¸íŠ¸:**
- @GetMapping, @RequestParam, @PathVariable
- ResponseEntityë¡œ ì‘ë‹µ
- REST API ì„¤ê³„

---

