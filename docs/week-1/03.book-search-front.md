# 03. 검색 UI: Thymeleaf와 Tabler 기반 화면 구축

Week 1의 세 번째 단계로, 적재된 도서 데이터를 사용자가 검색할 수 있는 기본적인 웹 인터페이스(Front-end) 구현 과정을 설명합니다.

## 1. 개요

사용자가 키워드를 통해 도서를 검색하고 그 결과를 확인할 수 있는 UI를 구축합니다. 이 단계에서는 앞서 구현한 [02. 기본 검색: LIKE 기반 동적 쿼리 구현](02.book-search-implementation.md) 로직을 화면과 연결하여 실제 서비스 형태를 완성하는 데 집중합니다. 검색 성능을 높이기 위한 인덱스 설정 및 전문 검색(Full Text Search) 적용은 다음 단계인 [04. 성능 최적화: 인덱싱과 전문 검색(Full Text Search)](04.search-optimization-and-indexing.md)에서 다룹니다. `guidelines.md`에 명시된 Tabler와 Bootstrap 5를 기반으로 일관된 UI/UX를 제공합니다.

## 2. 주요 개념 및 기술 스택

### 2.1. Thymeleaf Layout Dialect
모든 HTML 페이지에 공통 상단/하단을 복사-붙여넣기 하는 것은 유지보수에 좋지 않습니다.
- **Layout Dialect**: 하나의 `default.html` 레이아웃을 정의하고, 각 페이지는 본문(`content`) 프래그먼트만 작성하면 됩니다.

### 2.2. UI 디자인 시스템 (Tabler & Bootstrap 5)
백엔드 개발자도 깔끔한 UI를 만들 수 있도록 돕는 프레임워크입니다.
- **Bootstrap 5**: 웹 UI 구축을 위한 표준 CSS 프레임워크입니다.
- **Tabler**: Bootstrap 5 기반의 관리자 대시보드 템플릿(Admin Template)으로, 전문적인 디자인의 컴포넌트들을 제공합니다.

## 3. 구현 가이드 (Step-by-Step)

### 3.1. 컨트롤러(Controller) 구현
사용자의 검색어와 페이징 정보를 받아 서비스에 전달하고, 결과를 모델(`Model`)에 담아 뷰로 전달합니다.

**BookSearchController.java**
```java
@Controller
@RequiredArgsConstructor
public class BookSearchController {
    private final BookSearchService bookSearchService;

    @GetMapping("/")
    public String index(@Valid @ModelAttribute BookSearchRequest request,
                        @PageableDefault(size = 24) Pageable pageable,
                        Model model) {
        // 서비스 호출 및 결과 조회
        BookSearchResult result = bookSearchService.searchBooks(pageable, request);
        
        // 뷰에 데이터 전달
        model.addAttribute("books", result.getBooks().getContent());
        model.addAttribute("page", result.getBooks());
        model.addAttribute("request", request);
        
        return "index/index";
    }
}
```

### 3.2. 레이아웃(Layout) 설정
공통 UI 구성을 위해 `default.html` 레이아웃을 정의하고 이를 상속받아 사용합니다.

**default.html (레이아웃)**
```html
<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <!-- Tabler/Bootstrap CSS 포함 -->
</head>
<body>
    <header th:replace="~{fragments/header :: header}"></header>
    <main>
        <div layout:fragment="content"></div> <!-- 실제 콘텐츠가 들어갈 자리 -->
    </main>
    <footer th:replace="~{fragments/footer :: footer}"></footer>
</body>
</html>
```

### 3.3. 검색 화면(View) 구현
검색 폼과 결과 리스트를 구현합니다. `layout:decorate`를 통해 위에서 정의한 레이아웃을 적용합니다.

**index.html**
```html
<div layout:decorate="~{layouts/default}">
    <div layout:fragment="content">
        <!-- 검색 폼 -->
        <form th:action="@{/}" method="get">
            <input type="text" name="keyword" th:value="${request.keyword}">
            <button type="submit">검색</button>
        </form>

        <!-- 결과 리스트 -->
        <div class="row">
            <div th:each="book : ${books}" class="col-3">
                <img th:src="${book.imageUrl}">
                <h3 th:text="${book.title}">제목</h3>
            </div>
        </div>

        <!-- 페이징 처리 -->
        <div th:replace="~{fragments/pagination :: pagination(${page}, '/', ${request})}"></div>
    </div>
</div>
```

## 4. 전체 흐름 (Front-end)

1. **사용자 접속**: 웹 브라우저를 통해 메인 페이지(`/`)에 접속합니다.
2. **검색어 입력**: 사용자가 검색창에 키워드나 ISBN을 입력하고 검색 버튼을 클릭합니다.
3. **API 호출**: 컨트롤러가 검색 요청을 수신하고 `BookSearchService`를 호출합니다.
4. **결과 렌더링**: 서버에서 조회된 결과를 타임리프(Thymeleaf)와 공통 레이아웃(Tabler 기반)을 통해 HTML에 바인딩하여 사용자에게 응답합니다.
5. **상세 조회**: 사용자가 목록에서 도서를 클릭하면 `/books/{id}`를 호출하여 상세 정보를 확인합니다.

## 5. 학습 포인트

* **디자인 시스템 기반 UI 구축**: Bootstrap 5와 Tabler를 활용하여 전문적인 UI를 구축하고, `thymeleaf-layout-dialect`를 통해 중복 코드를 제거하는 레이아웃 구조화 기술을 습득합니다.
* **계층형 아키텍처와 DTO 활용**: Controller-Service-Repository 구조를 준수하며, 각 계층 간 데이터 전달을 위한 DTO의 역할과 필요성을 이해합니다.
* **전역 예외 처리 및 방어적 UI**: `GlobalExceptionHandler`를 통한 공통 에러 처리와, 이미지가 없는 도서에 대한 Placeholder 노출 등 사용자 경험(UX)을 고려한 예외 상황 대응 능력을 키웁니다.
* **Thymeleaf Fragment 활용**: 반복되는 UI 요소(Pagination 등)를 모듈화하여 코드 재사용성을 높이는 방법을 익힙니다.

## 6. UI 모듈화 (Pagination Fragment)

범용성과 유지보수성을 높이기 위해 페이징 로직을 별도의 파일로 분리하여 관리합니다.
* **경로**: `src/main/resources/templates/fragments/pagination.html`
* **사용법**: `th:replace` 속성을 사용하여 필요한 페이지에서 호출합니다.
    ```html
    <div th:replace="~{fragments/pagination :: pagination(${page}, '/', ${request})}"></div>
    ```
이러한 구조를 통해 다른 검색 화면에서도 동일한 페이징 UI와 로직을 재사용할 수 있습니다.

## 7. 화면 및 템플릿 구조

프로젝트의 유지보수성을 위해 HTML 템플릿은 논리적인 폴더 구조로 관리됩니다.

* `src/main/resources/templates/layouts/default.html`: 공통 레이아웃
* `src/main/resources/templates/index/index.html`: 도서 검색 목록 페이지
* `src/main/resources/templates/index/book-detail.html`: 도서 상세 정보 페이지
* `src/main/resources/templates/common/error/error.html`: 공통 에러 페이지
* `src/main/resources/templates/fragments/`: 재사용 가능한 UI 조각 (Pagination 등)

## 8. 향후 확장성

현재는 LIKE 검색 기반의 전통적인 방식이지만, 이후 주차에서 이 구조를 그대로 유지한 채 내부 로직을 **Vector 검색** 및 **AI 기반 검색**으로 교체하며 시스템의 진화를 경험하게 됩니다.

## 9. 깊이 공부하기 (Study Topics)

화면을 구성하고 데이터를 보여주는 프론트엔드 기술을 쉽게 알아봅시다.

### 9.1. 레이아웃(Layout) - 공통 틀 만들기
모든 페이지에 똑같은 메뉴바와 하단을 일일이 만드는 대신, 하나의 '틀'을 만들어두고 내용물만 갈아 끼우는 방식입니다.
- **비유**: 사진 액자는 그대로 두고 안에 들어갈 사진만 바꾸는 것과 같습니다. 틀(레이아웃)을 한 번 잘 만들어두면 집안(웹사이트) 전체가 깔끔해집니다.

### 9.2. 프래그먼트(Fragment) - 조각 조각 나누기
화면의 일부분(예: 페이지 번호)을 따로 떼어내서 부품처럼 만드는 것입니다.
- **비유**: 자동차의 타이어나 핸들처럼 부품을 따로 만들어두면, 나중에 다른 차(페이지)를 만들 때도 그 부품을 그대로 가져다 쓸 수 있습니다.

### 9.3. 폼 바인딩(Form Binding) - 상자와 데이터 연결
화면의 입력창(상자)과 자바 객체(데이터)를 끈으로 연결해두는 것입니다. 사용자가 입력창에 글을 쓰면 자동으로 자바 객체에 담기게 됩니다.
- **비유**: 이름표가 붙은 사물함과 같습니다. '검색어'라고 써진 칸에 물건을 넣으면, 나중에 '검색어'라는 이름으로 그 물건을 꺼내 쓸 수 있습니다.

## 10. 참고 링크

- [Thymeleaf Layout Dialect](https://ultraq.github.io/thymeleaf-layout-dialect/)
- [Tabler 공식 홈페이지 & 데모](https://tabler.io/)
- [Spring Data JPA Pagination](https://docs.spring.io/spring-data/jpa/reference/repositories/query-methods-details.html#repositories.special-parameters)
- [Thymeleaf Documentation](https://www.thymeleaf.org/documentation.html)
