# 02. ê¸°ë³¸ ê²€ìƒ‰: LIKE ê¸°ë°˜ ë™ì  ì¿¼ë¦¬ êµ¬í˜„

## í•™ìŠµ ì „ì œì¡°ê±´

ì´ ë¬¸ì„œë¥¼ í•™ìŠµí•˜ê¸° ì „ì— ë‹¤ìŒ ë‚´ìš©ì„ ì•Œê³  ìˆìœ¼ë©´ ë„ì›€ì´ ë©ë‹ˆë‹¤:
- Java ê¸°ì´ˆ ë¬¸ë²• (í´ë˜ìŠ¤, ì¸í„°í˜ì´ìŠ¤, ìƒì†)
- ë°ì´í„°ë² ì´ìŠ¤ ê¸°ì´ˆ (SELECT, WHERE, LIKE ì—°ì‚°ì)
- HTTP ê¸°ì´ˆ (GET ìš”ì²­, ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°)

---

## 1. ê°œìš”

ë°ì´í„°ë² ì´ìŠ¤ì— ì ì¬ëœ ë„ì„œ ë°ì´í„°ë¥¼ ê²€ìƒ‰í•˜ëŠ” ë°±ì—”ë“œ ë¡œì§ì„ ë‹¨ê³„ë³„ë¡œ êµ¬í˜„í•´ ë´…ë‹ˆë‹¤.

**ì´ ë¬¸ì„œì—ì„œ ë°°ìš¸ ë‚´ìš©:**
- ê²€ìƒ‰ ê¸°ëŠ¥ì„ ì™œ ë³„ë„ë¡œ êµ¬í˜„í•´ì•¼ í•˜ëŠ”ì§€
- DTOê°€ ë¬´ì—‡ì´ê³  ì™œ í•„ìš”í•œì§€
- Repositoryì—ì„œ ì–´ë–»ê²Œ ê²€ìƒ‰ ì¿¼ë¦¬ë¥¼ ë§Œë“œëŠ”ì§€
- QueryDSLì„ ì‚¬ìš©í•˜ì—¬ ë™ì  ê²€ìƒ‰ì„ êµ¬í˜„í•˜ëŠ” ë°©ë²•

> **ì¤‘ìš”: ì™œ ê²€ìƒ‰ì´ ì¤‘ìš”í• ê¹Œìš”?**
> ë„ì„œê´€ì— ì±…ì´ 100ë§Œ ê¶Œ ìˆë‹¤ê³  ìƒìƒí•´ ë³´ì„¸ìš”. ì›í•˜ëŠ” ì±…ì„ ì°¾ìœ¼ë ¤ë©´ ì œëª©, ì €ì, ì¶œíŒì‚¬ ë“±ìœ¼ë¡œ ê²€ìƒ‰í•  ìˆ˜ ìˆì–´ì•¼ í•©ë‹ˆë‹¤. ì´ ê²€ìƒ‰ ê¸°ëŠ¥ì´ ì—†ë‹¤ë©´ ì±…ì„ í•œ ê¶Œì”© ì „ë¶€ ë‹¤ ë’¤ì ¸ì•¼ í•  ê²ƒì…ë‹ˆë‹¤.

---

## 2. í•µì‹¬ ê°œë… ì´í•´

### 2.1. ê²€ìƒ‰ì´ë€ ë¬´ì—‡ì¸ê°€ìš”?

**ê²€ìƒ‰(Search)**ì€ ì›í•˜ëŠ” ë°ì´í„°ë¥¼ ë¹ ë¥´ê²Œ ì°¾ëŠ” ê³¼ì •ì…ë‹ˆë‹¤.

ë„ì„œ ê²€ìƒ‰ ì˜ˆì‹œ:
- **ì œëª©ìœ¼ë¡œ ê²€ìƒ‰**: "ìë°”"ê°€ ë“¤ì–´ê°„ ì±… ì°¾ê¸°
- **ì €ìë¡œ ê²€ìƒ‰**: "ë‚¨ê¶ì„±" ì“´ ì±… ì°¾ê¸°
- **ISBNìœ¼ë¡œ ê²€ìƒ‰**: ê³ ìœ ë²ˆí˜¸ë¡œ ì •í™•í•œ ì±… ì°¾ê¸°

### 2.2. DTO (Data Transfer Object)ë€?

**DTO**ëŠ” ê³„ì¸µ(Layer) ê°„ì— ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ê¸° ìœ„í•œ ê°ì²´ì…ë‹ˆë‹¤.

**ë¹„ìœ ë¡œ ì´í•´í•˜ê¸°:**
```
ì‹ë‹¹ì—ì„œ ì£¼ë¬¸í•  ë•Œë¥¼ ìƒê°í•´ ë³´ì„¸ìš”.

[ì†ë‹˜] â†’ [ì£¼ë¬¸ì„œ] â†’ [ì£¼ë°©]

ì£¼ë¬¸ì„œì—ëŠ”:
- ë©”ë‰´ ì´ë¦„
- ìˆ˜ëŸ‰
- ì£¼ë¬¸ ì‹œê°„

ì´ ì£¼ë¬¸ì„œê°€ ë°”ë¡œ DTOì…ë‹ˆë‹¤!
ì†ë‹˜ê³¼ ì£¼ë°©ì´ ì„œë¡œ ë‹¤ë¥¸ ì–¸ì–´ë¥¼ ì¨ë„,
ì£¼ë¬¸ì„œë¼ëŠ” í‘œì¤€ í˜•ì‹ì„ í†µí•´ ì†Œí†µí•  ìˆ˜ ìˆì£ .
```

**ì™œ DTOë¥¼ ì‚¬ìš©í• ê¹Œìš”?**

1. **ë³´ì•ˆ**: ì—”í‹°í‹°(Entity) ë‚´ë¶€ ì •ë³´ë¥¼ ë…¸ì¶œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤
2. **ë…ë¦½ì„±**: ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°ê°€ ë°”ê»´ë„ APIëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
3. **ëª…í™•ì„±**: ì „ë‹¬í•˜ë ¤ëŠ” ë°ì´í„°ê°€ ë¬´ì—‡ì¸ì§€ ëª…í™•í•©ë‹ˆë‹¤

**ìš”ì²­ê³¼ ì‘ë‹µ DTO ë¶„ë¦¬:**
- **Request DTO**: ì‚¬ìš©ìê°€ ë³´ë‚´ëŠ” ë°ì´í„° (ê²€ìƒ‰ì–´, í˜ì´ì§€ ë²ˆí˜¸ ë“±)
- **Response DTO**: ì„œë²„ê°€ ì‘ë‹µí•˜ëŠ” ë°ì´í„° (ê²€ìƒ‰ ê²°ê³¼, ì´ ê°œìˆ˜ ë“±)

### 2.3. Repository íŒ¨í„´ì´ë€?

**Repository**ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì™€ ì§ì ‘ ì†Œí†µí•˜ëŠ” ê°ì²´ì…ë‹ˆë‹¤.

**ë¹„ìœ ë¡œ ì´í•´í•˜ê¸°:**
```
ë„ì„œê´€ ì‚¬ì„œ(Repository)ê°€ ì±…ì„ ì°¾ì•„ì£¼ëŠ” ìƒí™©ì„ ìƒìƒí•´ ë³´ì„¸ìš”.

[ì†ë‹˜] â†’ [ì‚¬ì„œ] â†’ [ì±…ì¥]

ì†ë‹˜ì€ ì‚¬ì„œì—ê²Œ "ìë°” ì±… ì°¾ì•„ì£¼ì„¸ìš”"ë¼ê³  ë§í•©ë‹ˆë‹¤.
ì‚¬ì„œëŠ” ì±…ì¥ì—ì„œ ìë°” ì±…ì„ ì°¾ì•„ì„œ ê°€ì ¸ë‹¤ ì¤ë‹ˆë‹¤.

ì†ë‹˜ì€ ì±…ì¥ì´ ì–´ë””ì— ìˆëŠ”ì§€, ì–´ë–»ê²Œ ì°¾ëŠ”ì§€ ì•Œ í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.
ê·¸ëƒ¥ ì‚¬ì„œì—ê²Œ ìš”ì²­ë§Œ í•˜ë©´ ë©ë‹ˆë‹¤!

ì´ê²ƒì´ Repository íŒ¨í„´ì˜ í•µì‹¬ì…ë‹ˆë‹¤.
```

### 2.4. LIKE ê²€ìƒ‰ì´ë€?

**LIKE**ëŠ” SQLì—ì„œ ë¶€ë¶„ ì¼ì¹˜ ê²€ìƒ‰ì„ í•˜ëŠ” ì—°ì‚°ìì…ë‹ˆë‹¤.

**ì˜ˆì‹œ:**
```sql
-- ì œëª©ì— "ìë°”"ê°€ ë“¤ì–´ê°„ ì±… ì°¾ê¸°
SELECT * FROM books
WHERE title LIKE '%ìë°”%'

-- ê²°ê³¼:
- "Javaì˜ ì •ì„"
- "ìë°” ì½”ë”©ì˜ ë²•ì¹™"
- "ì´ê²ƒì´ ìë°”ë‹¤"
```

**LIKE ê²€ìƒ‰ì˜ íŠ¹ì§•:**
- êµ¬í˜„ì´ ì‰½ìŠµë‹ˆë‹¤
- ê°„ë‹¨í•œ ê²€ìƒ‰ì—ëŠ” ì¶©ë¶„í•©ë‹ˆë‹¤
- ë°ì´í„°ê°€ ë§ìœ¼ë©´ ëŠë ¤ì§‘ë‹ˆë‹¤
- ìƒ‰ì¸(Index)ë¥¼ í™œìš©í•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤

### 2.5. QueryDSLì´ë€?

**QueryDSL**ì€ ìë°” ì½”ë“œë¡œ ì•ˆì „í•˜ê²Œ SQL ì¿¼ë¦¬ë¥¼ ë§Œë“¤ ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤.

**ì™œ QueryDSLì„ ì‚¬ìš©í• ê¹Œìš”?**

**ì¼ë°˜ SQLì˜ ë¬¸ì œì :**
```sql
-- ë¬¸ìì—´ë¡œ ì¿¼ë¦¬ ì‘ì„± (ì˜¤íƒ€ ìœ„í—˜!)
String query = "SELECT * FROM books WHERE title LIKE '%" + keyword + "%'";
// ì—ëŸ¬: "book" â†’ "bok" (ì˜¤íƒ€ë¥¼ ì»´íŒŒì¼ íƒ€ì„ì— ì•Œ ìˆ˜ ì—†ìŒ)
```

**QueryDSLì˜ ì¥ì :**
```java
// ìë°” ì½”ë“œë¡œ ì¿¼ë¦¬ ì‘ì„± (íƒ€ì… ì„¸ì´í”„!)
queryFactory.selectFrom(book)
    .where(title.contains(keyword))  // ì˜¤íƒ€ê°€ ìˆìœ¼ë©´ ì»´íŒŒì¼ ì—ëŸ¬!
    .fetch();
```

**ë¹„ìœ ë¡œ ì´í•´í•˜ê¸°:**
```
SQLì€ "ì¢…ì´ì— ì†ê¸€ì”¨ë¡œ ì¿¼ë¦¬ ì‘ì„±"í•˜ëŠ” ê²ƒê³¼ ê°™ìŠµë‹ˆë‹¤.
ì˜¤íƒ€ê°€ ë‚˜ë„ ì‹¤í–‰í•´ë´ì•¼ ì•Œ ìˆ˜ ìˆì£ .

QueryDSLì€ "ë ˆê³  ë¸”ë¡ ì¡°ë¦½"í•˜ëŠ” ê²ƒê³¼ ê°™ìŠµë‹ˆë‹¤.
ì˜ëª»ëœ ë¸”ë¡ì„ ë¼ìš°ë ¤ í•˜ë©´ ì»´í“¨í„°ê°€ ë°”ë¡œ ì•Œë ¤ì¤ë‹ˆë‹¤.
```

---

## 3. êµ¬í˜„ ê°€ì´ë“œ (Step-by-Step)

### STEP 1: DTO ì •ì˜í•˜ê¸°

ê°€ì¥ ë¨¼ì € ê³„ì¸µ ê°„ ë°ì´í„° ì „ë‹¬ì„ ìœ„í•œ DTOë¥¼ ë§Œë“­ë‹ˆë‹¤.

**BookSearchRequest.java (ìš”ì²­ DTO)**

ì‚¬ìš©ìê°€ ê²€ìƒ‰í•  ë•Œ ë³´ë‚´ëŠ” ë°ì´í„°ì…ë‹ˆë‹¤.

```java
package com.nhnacademy.library.core.book.dto;

import com.nhnacademy.library.core.book.domain.SearchType;
import jakarta.validation.constraints.Size;

/**
 * ë„ì„œ ê²€ìƒ‰ ìš”ì²­ DTO
 *
 * @record ë¶ˆë³€ ê°ì²´(Immutable Object)ë¡œ ì„ ì–¸í•˜ì—¬ ë°ì´í„° ì•ˆì „ì„± í™•ë³´
 */
public record BookSearchRequest(

    // ê²€ìƒ‰ í‚¤ì›Œë“œ (ìµœëŒ€ 100ì)
    @Size(max = 100, message = "ê²€ìƒ‰ì–´ëŠ” 100ì ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤")
    String keyword,

    // ISBN ë²ˆí˜¸ (ì •í™•í•œ ì¼ì¹˜ ê²€ìƒ‰)
    @Size(max = 20, message = "ISBNì€ 20ì ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤")
    String isbn,

    // ê²€ìƒ‰ ìœ í˜• (KEYWORD, VECTOR, HYBRID ë“±)
    SearchType searchType,

    // ë²¡í„° ê²€ìƒ‰ì„ ìœ„í•œ ì„ë² ë”© ê°’
    float[] vector,

    // ìºì‹œ ì›Œë°ì—… í”Œë˜ê·¸
    Boolean isWarmUp
) {
    /**
     * ê¸°ë³¸ ìƒì„±ì
     * null ê°’ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ ë©”ì„œë“œ ì œê³µ
     */
    public String keyword() {
        return keyword != null ? keyword : "";
    }

    public String isbn() {
        return isbn != null ? isbn : "";
    }
}
```

**BookSearchResponse.java (ì‘ë‹µ DTO)**

ê²€ìƒ‰ ê²°ê³¼ë¥¼ ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì¤„ ë°ì´í„°ì…ë‹ˆë‹¤.

```java
package com.nhnacademy.library.core.book.dto;

import com.querydsl.core.annotations.QueryProjection;
import lombok.Getter;
import lombok.NoArgsConstructor;

/**
 * ë„ì„œ ê²€ìƒ‰ ì‘ë‹µ DTO
 *
 * @QueryProjection QueryDSLì˜ Projections ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì—¬
 *                  ì—”í‹°í‹°ê°€ ì•„ë‹Œ DTOë¡œ ì§ì ‘ ë°ì´í„° ì¡°íšŒ
 */
@Getter
@NoArgsConstructor
public class BookSearchResponse {

    // ë„ì„œ ID
    private Long id;

    // ISBN (ê³ ìœ ë²ˆí˜¸)
    private String isbn;

    // ë„ì„œ ì œëª©
    private String title;

    // ì €ìëª…
    private String authorName;

    // ì¶œíŒì‚¬ëª…
    private String publisherName;

    // ë„ì„œ ë‚´ìš© ë¯¸ë¦¬ë³´ê¸°
    private String bookContent;

    // í‘œì§€ ì´ë¯¸ì§€ URL
    private String imageUrl;

    /**
     * QueryProjectionì„ ìœ„í•œ ìƒì„±ì
     * QueryDSLì´ ì´ ìƒì„±ìë¥¼ í˜¸ì¶œí•˜ì—¬ DTO ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
     */
    @QueryProjection
    public BookSearchResponse(
        Long id,
        String isbn,
        String title,
        String authorName,
        String publisherName,
        String bookContent,
        String imageUrl
    ) {
        this.id = id;
        this.isbn = isbn;
        this.title = title;
        this.authorName = authorName;
        this.publisherName = publisherName;
        this.bookContent = bookContent;
        this.imageUrl = imageUrl;
    }
}
```

> **ğŸ“ í•™ìŠµ í¬ì¸íŠ¸: DTO vs Entity**
>
> **Entity (ì—”í‹°í‹°)**: ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ê³¼ 1:1 ë§¤ì¹­ë˜ëŠ” í´ë˜ìŠ¤
> - DB êµ¬ì¡°ë¥¼ ê·¸ëŒ€ë¡œ ë°˜ì˜
> - ë‚´ë¶€ êµ¬í˜„ì„ ë…¸ì¶œí•  ìˆ˜ ìˆìŒ
>
> **DTO**: ê³„ì¸µ ê°„ ë°ì´í„° ì „ë‹¬ìš© í´ë˜ìŠ¤
> - í•„ìš”í•œ ë°ì´í„°ë§Œ ì„ íƒì ìœ¼ë¡œ í¬í•¨
> - DB êµ¬ì¡° ë³€ê²½ì— ì˜í–¥ë°›ì§€ ì•ŠìŒ
> - API ëª…ì„¸ë¥¼ ëª…í™•íˆ ì •ì˜

---

### STEP 2: Repository ì¸í„°í˜ì´ìŠ¤ ë§Œë“¤ê¸°

Spring Data JPAì˜ ê¸°ë³¸ ê¸°ëŠ¥ë§Œìœ¼ë¡œëŠ” ë¶€ì¡±í•  ë•Œ, ì»¤ìŠ¤í…€ ì¿¼ë¦¬ë¥¼ ìœ„í•´ ì¸í„°í˜ì´ìŠ¤ë¥¼ ë¶„ë¦¬í•©ë‹ˆë‹¤.

**BookRepository.java (ê¸°ë³¸ Repository)**

```java
package com.nhnacademy.library.core.book.repository;

import com.nhnacademy.library.core.book.domain.Book;
import com.nhnacademy.library.core.book.dto.BookSearchRequest;
import com.nhnacademy.library.core.book.dto.BookSearchResponse;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.data.repository.query.FluentQuery;

import java.util.Optional;
import java.util.function.Function;

/**
 * ë„ì„œ Repository ì¸í„°í˜ì´ìŠ¤
 *
 * Spring Data JPAê°€ ìë™ìœ¼ë¡œ êµ¬í˜„ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
 */
public interface BookRepository extends
    JpaRepository<Book, Long>,      // ê¸°ë³¸ CRUD ì œê³µ
    BookRepositoryCustom {          // ì»¤ìŠ¤í…€ ê²€ìƒ‰ ê¸°ëŠ¥ ì¶”ê°€

    // ISBNìœ¼ë¡œ ë„ì„œ ì¡°íšŒ (ì •í™•íˆ ì¼ì¹˜)
    Optional<Book> findByIsbn(String isbn);

    // íŠ¹ì • í•„ë“œë§Œ ì¡°íšŒ (Projections)
    @Query("SELECT b FROM Book b WHERE b.id = :id")
    Optional<Book> findBookById(@Param("id") Long id);
}
```

**BookRepositoryCustom.java (ì»¤ìŠ¤í…€ ê²€ìƒ‰ ì¸í„°í˜ì´ìŠ¤)**

```java
package com.nhnacademy.library.core.book.repository;

import com.nhnacademy.library.core.book.dto.BookSearchRequest;
import com.nhnacademy.library.core.book.dto.BookSearchResponse;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;

/**
 * ì»¤ìŠ¤í…€ ë„ì„œ Repository ì¸í„°í˜ì´ìŠ¤
 *
 * QueryDSLì„ ì‚¬ìš©í•œ ë³µì¡í•œ ê²€ìƒ‰ ê¸°ëŠ¥ì„ ì •ì˜í•©ë‹ˆë‹¤.
 */
public interface BookRepositoryCustom {

    /**
     * ë™ì  ê²€ìƒ‰ ê¸°ëŠ¥
     *
     * @param pageable í˜ì´ì§• ì •ë³´ (í˜ì´ì§€ ë²ˆí˜¸, í¬ê¸°, ì •ë ¬)
     * @param request ê²€ìƒ‰ ì¡°ê±´ (í‚¤ì›Œë“œ, ISBN, ê²€ìƒ‰ ìœ í˜• ë“±)
     * @return ê²€ìƒ‰ ê²°ê³¼ í˜ì´ì§€
     */
    Page<BookSearchResponse> search(Pageable pageable, BookSearchRequest request);
}
```

---

### STEP 3: QueryDSL êµ¬í˜„ì²´ ì‘ì„±í•˜ê¸°

ì´ì œ ì‹¤ì œ ê²€ìƒ‰ ë¡œì§ì„ êµ¬í˜„í•©ë‹ˆë‹¤.

**BookRepositoryImpl.java**

```java
package com.nhnacademy.library.core.book.repository;

import com.nhnacademy.library.core.book.domain.QBook;
import com.nhnacademy.library.core.book.dto.BookSearchRequest;
import com.nhnacademy.library.core.book.dto.BookSearchResponse;
import com.nhnacademy.library.core.book.dto.QBookSearchResponse;
import com.querydsl.core.BooleanBuilder;
import com.querydsl.jpa.impl.JPAQueryFactory;
import jakarta.persistence.EntityManager;
import lombok.RequiredArgsConstructor;
import org.apache.commons.lang3.StringUtils;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageImpl;
import org.springframework.data.domain.Pageable;
import org.springframework.stereotype.Component;

/**
 * ì»¤ìŠ¤í…€ ë„ì„œ Repository êµ¬í˜„ì²´
 *
 * QueryDSLì„ ì‚¬ìš©í•˜ì—¬ ë™ì  ê²€ìƒ‰ ì¿¼ë¦¬ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
 */
@Component
@RequiredArgsConstructor
public class BookRepositoryImpl implements BookRepositoryCustom {

    private final JPAQueryFactory queryFactory;

    // Qíƒ€ì…: QueryDSLì´ ìƒì„±í•œ ì—”í‹°í‹° ë©”íƒ€ëª¨ë¸
    QBook book = QBook.book;

    @Override
    public Page<BookSearchResponse> search(Pageable pageable, BookSearchRequest request) {

        // 1. ë°ì´í„° ì¡°íšŒ
        List<BookSearchResponse> results = queryFactory
                .select(new QBookSearchResponse(  // DTOë¡œ ì§ì ‘ í”„ë¡œì ì…˜
                        book.id,
                        book.isbn,
                        book.title,
                        book.authorName,
                        book.publisherName,
                        book.bookContent,
                        book.imageUrl
                ))
                .from(book)                          // FROM books
                .where(commonWhere(request))         // WHERE ë™ì  ì¡°ê±´ ì ìš©
                .offset(pageable.getOffset())        // OFFSET ì‹œì‘ ìœ„ì¹˜
                .limit(pageable.getPageSize())       // LIMIT ê°€ì ¸ì˜¬ ê°œìˆ˜
                .fetch();                            // ì‹¤í–‰ ë° ê²°ê³¼ ë°˜í™˜

        // 2. ì „ì²´ ê°œìˆ˜ ì¡°íšŒ
        long total = queryFactory
                .select(book.count())                // SELECT COUNT(*)
                .from(book)
                .where(commonWhere(request))
                .fetchOne();                         // ë‹¨ì¼ ê²°ê³¼ ë°˜í™˜

        // 3. Page ê°ì²´ë¡œ ë˜í•‘
        return new PageImpl<>(results, pageable, total);
    }

    /**
     * ë™ì  ê²€ìƒ‰ ì¡°ê±´ ìƒì„±
     *
     * BooleanBuilderë¥¼ ì‚¬ìš©í•˜ì—¬ nullì´ê±°ë‚˜ ë¹ˆ ê°’ì¸ ì¡°ê±´ì€ ìë™ìœ¼ë¡œ ì œì™¸í•©ë‹ˆë‹¤.
     *
     * @param request ê²€ìƒ‰ ìš”ì²­
     * @return ë™ì  ì¡°ê±´ ë¹Œë”
     */
    private BooleanBuilder commonWhere(BookSearchRequest request) {
        BooleanBuilder builder = new BooleanBuilder();

        // í‚¤ì›Œë“œ ê²€ìƒ‰ (ì œëª© ë˜ëŠ” ì €ìëª…)
        if (StringUtils.isNotEmpty(request.keyword())) {
            builder.and(
                book.title.containsIgnoreCase(request.keyword())     // ì œëª© í¬í•¨ (ëŒ€ì†Œë¬¸ì ë¬´ì‹œ)
                    .or(book.authorName.containsIgnoreCase(request.keyword()))  // ë˜ëŠ” ì €ìëª… í¬í•¨
            );
        }

        // ISBN ì •í™•íˆ ì¼ì¹˜ ê²€ìƒ‰
        if (StringUtils.isNotEmpty(request.isbn())) {
            builder.and(book.isbn.eq(request.isbn()));  // isbn = 'ì…ë ¥ê°’'
        }

        return builder;
    }
}
```

---

### STEP 4: ë™ì  ì¿¼ë¦¬ ì´í•´í•˜ê¸°

**BooleanBuilder**ëŠ” ìƒí™©ì— ë”°ë¼ ì¿¼ë¦¬ê°€ ë³€í•˜ëŠ” "ë™ì  ì¿¼ë¦¬"ë¥¼ ë§Œë“¤ ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.

**ì˜ˆì‹œ: ì‡¼í•‘ëª° í•„í„°**

ì‚¬ìš©ìê°€ ë‹¤ì–‘í•œ ì¡°ê±´ìœ¼ë¡œ ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
- ì¹´í…Œê³ ë¦¬ë§Œ ì„ íƒ
- ê°€ê²©ëŒ€ë§Œ ì„ íƒ
- ì¹´í…Œê³ ë¦¬ + ê°€ê²©ëŒ€ + ë¸Œëœë“œ ëª¨ë‘ ì„ íƒ

**BooleanBuilder ì‚¬ìš© ì˜ˆì‹œ:**

```java
BooleanBuilder builder = new BooleanBuilder();

// ì‚¬ìš©ìê°€ ì…ë ¥í•œ ì¡°ê±´ë§Œ ì¶”ê°€
if (category != null) {
    builder.and(product.category.eq(category));
}

if (minPrice != null) {
    builder.and(product.price.goe(minPrice));  // goe = greater or equal
}

if (brand != null) {
    builder.and(product.brand.eq(brand));
}

// ê²°ê³¼: ì¡°ê±´ì— ë”°ë¼ ë‹¤ë¥¸ ì¿¼ë¦¬ ìƒì„±!
// categoryë§Œ ì…ë ¥: WHERE category = 'books'
// category + price: WHERE category = 'books' AND price >= 10000
// ëª¨ë‘ ì…ë ¥: WHERE category = 'books' AND price >= 10000 AND brand = 'A'
```

---

## 4. ì „ì²´ íë¦„ ì´í•´í•˜ê¸°

ê²€ìƒ‰ ê¸°ëŠ¥ì˜ ì „ì²´ íë¦„ì„ ë‹¨ê³„ë³„ë¡œ ë”°ë¼ê°€ ë³´ì„¸ìš”.

```
ì‚¬ìš©ì                        Controller                      Service                    Repository
  â”‚                              â”‚                              â”‚                           â”‚
  â”‚  ê²€ìƒ‰ ìš”ì²­                     â”‚                              â”‚                           â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                              â”‚                           â”‚
  â”‚  GET /books?keyword=ìë°”      â”‚                              â”‚                           â”‚
  â”‚                              â”‚                              â”‚                           â”‚
  â”‚                              â”‚  ê²€ìƒ‰ ìš”ì²­                     â”‚                           â”‚
  â”‚                              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                           â”‚
  â”‚                              â”‚  search(keyword, pageable)   â”‚                           â”‚
  â”‚                              â”‚                              â”‚                           â”‚
  â”‚                              â”‚                              â”‚  DB ì¡°íšŒ ìš”ì²­              â”‚
  â”‚                              â”‚                              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                              â”‚                              â”‚  search(pageable, request) â”‚
  â”‚                              â”‚                              â”‚                           â”‚
  â”‚                              â”‚                              â”‚                           â”‚
  â”‚                              â”‚                              â”‚  SELECT * FROM books      â”‚
  â”‚                              â”‚                              â”‚  WHERE title LIKE '%ìë°”%'â”‚
  â”‚                              â”‚                              â”‚  OFFSET 0 LIMIT 20         â”‚
  â”‚                              â”‚                              â”‚                           â”‚
  â”‚                              â”‚                              â”‚  ê²€ìƒ‰ ê²°ê³¼ ë°˜í™˜            â”‚
  â”‚                              â”‚                             â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                              â”‚                              â”‚  Page<BookSearchResponse> â”‚
  â”‚                              â”‚                              â”‚                           â”‚
  â”‚                              â”‚  ê²€ìƒ‰ ê²°ê³¼ ì „ë‹¬               â”‚                           â”‚
  â”‚                              â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                           â”‚
  â”‚                              â”‚  Page<BookSearchResponse>    â”‚                           â”‚
  â”‚                              â”‚                              â”‚                           â”‚
  â”‚  JSON ì‘ë‹µ                    â”‚                              â”‚                           â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                              â”‚                           â”‚
  â”‚  [{ "title": "Javaì˜ ì •ì„",   â”‚                              â”‚                           â”‚
  â”‚      "author": "ë‚¨ê¶ì„±",      â”‚                              â”‚                           â”‚
  â”‚      ... }]                  â”‚                              â”‚                           â”‚
```

---

## 5. ì‹¤ìŠµ ë¯¸ì…˜

### ë¯¸ì…˜ 1: DTO ì§ì ‘ ë§Œë“¤ì–´ë³´ê¸°

ë‹¤ìŒ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” `ReviewSearchRequest` DTOë¥¼ ë§Œë“¤ì–´ ë³´ì„¸ìš”:
- ê²€ìƒ‰ í‚¤ì›Œë“œ (String, ìµœëŒ€ 100ì)
- ë³„ì  ìµœì†Ÿê°’ (Integer, 1~5)
- ì‘ì„±ì¼ì ê¸°ì¤€ (LocalDate)

### ë¯¸ì…˜ 2: ë™ì  ì¿¼ë¦¬ ë§Œë“¤ì–´ë³´ê¸°

ë‹¤ìŒ ì¡°ê±´ì— ë§ëŠ” `BooleanBuilder`ë¥¼ ì‘ì„±í•´ ë³´ì„¸ìš”:
- í‚¤ì›Œë“œê°€ ìˆìœ¼ë©´: ë¦¬ë·° ë‚´ìš©ì— í‚¤ì›Œë“œ í¬í•¨
- ë³„ì ì´ ìˆìœ¼ë©´: ë³„ì ì´ ìµœì†Ÿê°’ ì´ìƒ
- ë‚ ì§œê°€ ìˆìœ¼ë©´: í•´ë‹¹ ë‚ ì§œ ì´í›„ ì‘ì„±ëœ ë¦¬ë·°ë§Œ

### ë¯¸ì…˜ 3: ì¿¼ë¦¬ ë¡œê·¸ í™•ì¸í•˜ê¸°

`application.properties`ì— ë‹¤ìŒ ì„¤ì •ì„ ì¶”ê°€í•˜ê³  ì‹¤ì œë¡œ ì–´ë–¤ SQLì´ ìƒì„±ë˜ëŠ”ì§€ í™•ì¸í•´ ë³´ì„¸ìš”:

```properties
# SQL ë¡œê·¸ ì¶œë ¥
spring.jpa.show-sql=true

# SQL ì˜ˆì˜ê²Œ ì¶œë ¥
spring.jpa.properties.hibernate.format_sql=true
```

---

## 6. í•™ìŠµ ì²´í¬ë¦¬ìŠ¤íŠ¸

ë‹¤ìŒ ë‚´ìš©ì„ ì´í•´í–ˆëŠ”ì§€ í™•ì¸í•´ ë³´ì„¸ìš”:

- [ ] DTOê°€ ë¬´ì—‡ì´ê³  ì™œ í•„ìš”í•œì§€ ì„¤ëª…í•  ìˆ˜ ìˆë‹¤
- [ ] Repository íŒ¨í„´ì˜ ì—­í• ì„ ì´í•´í•œë‹¤
- [ ] LIKE ê²€ìƒ‰ì˜ ê¸°ë³¸ ì›ë¦¬ë¥¼ ì•ˆë‹¤
- [ ] QueryDSLì„ ì‚¬ìš©í•˜ëŠ” ì´ìœ ë¥¼ ì„¤ëª…í•  ìˆ˜ ìˆë‹¤
- [ ] BooleanBuilderë¡œ ë™ì  ì¿¼ë¦¬ë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤
- [ ] Pageableë¡œ í˜ì´ì§• ì²˜ë¦¬ë¥¼ í•  ìˆ˜ ìˆë‹¤

---

## 7. ë‹¤ìŒ ë‹¨ê³„

ë‹¤ìŒ ë¬¸ì„œì—ì„œëŠ” **ê²€ìƒ‰ UI êµ¬í˜„**ì„ ë°°ì›ë‹ˆë‹¤:
- Thymeleaf í…œí”Œë¦¿ìœ¼ë¡œ ê²€ìƒ‰ í¼ ë§Œë“¤ê¸°
- ê²€ìƒ‰ ê²°ê³¼ë¥¼ í™”ë©´ì— í‘œí˜„í•˜ê¸°
- í˜ì´ì§• ë„¤ë¹„ê²Œì´ì…˜ êµ¬í˜„í•˜ê¸°

[ë‹¤ìŒ: 03. ê²€ìƒ‰ UI êµ¬í˜„ â†’](03.book-search-front.md)
